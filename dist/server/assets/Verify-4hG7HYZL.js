var b=(d,t,n)=>new Promise((h,o)=>{var f=a=>{try{c(n.next(a))}catch(m){o(m)}},u=a=>{try{c(n.throw(a))}catch(m){o(m)}},c=a=>a.done?h(a.value):Promise.resolve(a.value).then(f,u);c((n=n.apply(d,t)).next())});import{jsx as i,jsxs as p,Fragment as x}from"react/jsx-runtime";import{useState as v,useEffect as E}from"react";import{useSearchParams as N,useNavigate as j}from"react-router-dom";import{u as z,t as l,a as k,p as w,s as S,T as C}from"./entry-server-CsfnY5-Y.js";import"react-dom/server";import"react-router-dom/server.mjs";import"stream";import"framer-motion";import"react-dom";import"axios";import"gsap";import"gsap/ScrollTrigger.js";function G({onVerified:d}){const{darkMode:t}=z(),[n]=N(),[h,o]=v("loading"),[f,u]=v(""),[c,a]=v(!1),m=j();E(()=>{const s=n.get("token");if(!s){o("error"),l("Missing verification token",{type:"error"});return}b(this,null,function*(){var g,r;try{yield k.get("/auth/verify-email",{params:{token:s}}).then(w());try{const e=yield k.get("/auth/me").then(w("user"));e&&(d==null||d(e),u(e.email))}catch(e){}o("success"),l("Email verified! You’re good to go.",{type:"success"}),setTimeout(()=>m("/dashboard"),1500)}catch(e){o("error");const T=((r=(g=e==null?void 0:e.response)==null?void 0:g.data)==null?void 0:r.message)||(e==null?void 0:e.message)||"Verification failed";l(T,{type:"error"})}})},[]);const R=()=>b(this,null,function*(){var s,g;if(!f){l("No email found. Please sign in first.",{type:"error"});return}try{a(!0),yield k.post("/auth/resend-verification",{email:f}),l("Verification email resent",{type:"success"})}catch(r){const e=((g=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:g.message)||(r==null?void 0:r.message)||"Resend failed";l(e,{type:"error"})}finally{a(!1)}}),y=s=>i("section",{style:{padding:`${S("2xl",1.5)} 0`},children:p("div",{className:"container",style:{maxWidth:"640px",margin:"0 auto",display:"grid",gap:S("md"),textAlign:"center",background:t?"rgba(15,23,42,0.75)":"rgba(255,255,255,0.95)",borderRadius:"1.5rem",padding:S("xl"),border:`1px solid ${t?"rgba(148,163,184,0.25)":"rgba(148,163,184,0.35)"}`,boxShadow:t?"0 35px 65px rgba(8, 15, 34, 0.55)":"0 35px 65px rgba(148, 163, 184, 0.35)"},children:[p("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i("div",{style:{fontWeight:700,color:t?"#cbd5e1":"#475569"},children:"Email verification"}),i(C,{})]}),s]})});return y(h==="loading"?p(x,{children:[i("h2",{style:{fontSize:"1.75rem"},children:"Verifying your email…"}),i("div",{className:"loading",style:{width:"40px",height:"40px",margin:"0 auto"}})]}):h==="success"?p(x,{children:[i("h2",{style:{fontSize:"1.75rem",color:t?"#6ee7b7":"#047857"},children:"✅ Verified! Redirecting…"}),i("p",{style:{color:t?"#94a3b8":"#475569"},children:"Hang tight, taking you to the dashboard."})]}):p(x,{children:[i("h2",{style:{fontSize:"1.75rem",color:t?"#fda4af":"#b91c1c"},children:"Verification error"}),i("p",{style:{color:t?"#94a3b8":"#475569"},children:"We couldn’t verify that link. The token may have expired."}),i("button",{className:"btn btn-primary",disabled:c,onClick:R,children:c?"Resending…":"Resend Verification Email"})]}))}export{G as default};
