var pe=Object.defineProperty,ue=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var _=(d,p,o)=>p in d?pe(d,p,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[p]=o,F=(d,p)=>{for(var o in p||(p={}))ge.call(p,o)&&_(d,o,p[o]);if(Z)for(var o of Z(p))be.call(p,o)&&_(d,o,p[o]);return d},Y=(d,p)=>ue(d,me(p));var V=(d,p,o)=>new Promise((r,t)=>{var S=s=>{try{y(o.next(s))}catch(k){t(k)}},n=s=>{try{y(o.throw(s))}catch(k){t(k)}},y=s=>s.done?r(s.value):Promise.resolve(s.value).then(S,n);y((o=o.apply(d,p)).next())});import{jsx as i,jsxs as c,Fragment as L}from"react/jsx-runtime";import{useState as C,useRef as Q,useMemo as U,useEffect as M,useCallback as f}from"react";import{u as he,a as X,T as fe}from"./entry-server-CsfnY5-Y.js";import ye from"lodash/debounce.js";import"react-dom/server";import"react-router-dom/server.mjs";import"stream";import"react-router-dom";import"framer-motion";import"react-dom";import"axios";import"gsap";import"gsap/ScrollTrigger.js";const P=({label:d,type:p="text",field:o,placeholder:r,required:t=!1,hint:S,autoComplete:n,form:y,fieldErrors:s,handleInputChange:k,loading:I,darkMode:h})=>c("div",{className:"form-group",style:{display:"grid",gap:"calc(var(--space-2xs) * 1.5)"},children:[c("label",{className:"form-label",style:{fontWeight:600,color:h?"#e2e8f0":"#1f2937"},children:[d," ",t&&i("span",{style:{color:"#ef4444"},children:"*"})]}),i("input",{className:`form-input ${s[o]?"error":""}`,type:p,value:y[o],onChange:x=>k(o,x.target.value),placeholder:r,required:t,disabled:I,autoComplete:n,style:{borderColor:s[o]?"#ef4444":h?"rgba(148,163,184,0.4)":"rgba(148,163,184,0.55)",background:h?"rgba(15,23,42,0.85)":"rgba(255,255,255,0.95)",color:h?"#e2e8f0":"#1f2937",padding:"var(--space-xs) var(--space-sm)",borderRadius:"0.85rem",transition:"all 0.2s ease"}}),s[o]&&c("div",{style:{color:"#ef4444",fontSize:"0.75rem",marginTop:"var(--space-2xs)",display:"flex",alignItems:"center",gap:"var(--space-2xs)"},children:[i("span",{children:"⚠ "}),s[o]]}),S&&!s[o]&&i("small",{className:"form-hint",style:{color:h?"#94a3b8":"#475569",fontSize:"0.8rem"},children:S})]}),ze=({onClose:d,onAuthenticated:p,initialMode:o="signin"})=>{const{darkMode:r}=he(),[t,S]=C(o),[n,y]=C({email:"",password:"",businessName:"",businessPhone:"",businessEmail:"",websiteUrl:""}),[s,k]=C(!1),[I,h]=C(""),[x,R]=C({}),[$,ee]=C(""),[g,W]=C(0),q=Q(null),z=Q(!1),O=U(()=>t==="signup"?[["email","password"],["businessName","businessPhone","businessEmail","websiteUrl"]]:[["email","password"]],[t]),se=U(()=>t==="signup"?["Account","Business Profile"]:["Secure Sign In"],[t]),N=O.length,D=g>=N-1,re=Math.round((g+1)/N*100);M(()=>{V(void 0,null,function*(){try{const a=yield X.get("/auth/csrf-token");ee(a.data.csrfToken)}catch(a){console.warn("Could not get CSRF token:",a)}})},[]),M(()=>{W(0),h(""),R({})},[t]);const A=U(()=>({email:e=>{var l;const a=((l=e==null?void 0:e.trim)==null?void 0:l.call(e))||"";return a?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)?null:"Invalid email format":"Email is required"},password:e=>{if(!e)return"Password is required";if(t==="signup"){if(e.length<12)return"Password must be at least 12 characters";if(!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])/.test(e))return"Password must include uppercase, lowercase, number, and special character"}return null},businessName:e=>{var l;if(t!=="signup")return null;const a=((l=e==null?void 0:e.trim)==null?void 0:l.call(e))||"";return!a||a.length<2?"Business name is required":null},businessPhone:e=>e?/^\+?[\d\s\-()]+$/.test(e)?null:"Invalid phone number format":null,businessEmail:e=>e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?null:"Invalid business email format":null,websiteUrl:e=>e?/^https?:\/\/.+\..+/.test(e)?null:"Website URL must include protocol (https://)":null}),[t]),G=f((e,a=n[e])=>{const l=A[e];if(!l)return!0;const m=l(a);return R(u=>Y(F({},u),{[e]:m})),!m},[n,A]),j=U(()=>ye((e,a)=>{G(e,a)},250),[G]);M(()=>()=>j.cancel(),[j]);const E=f((e,a)=>{y(l=>Y(F({},l),{[e]:a})),h(""),j(e,a)},[j]),B=f(e=>{const a=e&&e.length?e:Object.keys(A),l={};return a.forEach(m=>{const u=A[m];u&&(l[m]=u(n[m])||null)}),Object.keys(l).length&&R(m=>F(F({},m),Object.fromEntries(Object.entries(l).map(([u,b])=>[u,b])))),Object.values(l).every(m=>!m)},[n,A]),T=f(()=>B(),[B]),H=f(()=>B(O[g]||[]),[O,g,B]),J=f(()=>{S(e=>e==="signin"?"signup":"signin"),h(""),R({}),W(0),y({email:n.email,password:"",businessName:"",businessPhone:"",businessEmail:"",websiteUrl:""})},[n.email]),K=f(()=>V(void 0,null,function*(){var e,a,l,m;if(!(z.current||s)){if(z.current=!0,h(""),!T()){z.current=!1;return}k(!0);try{const u=n.email.trim().toLowerCase(),b=F({identifier:u,email:u,password:n.password},$&&{_csrf:$});t==="signup"&&(b.businessName=n.businessName.trim(),(e=n.businessPhone)!=null&&e.trim()&&(b.businessPhone=n.businessPhone.trim()),(a=n.businessEmail)!=null&&a.trim()&&(b.businessEmail=n.businessEmail.trim().toLowerCase()),(l=n.websiteUrl)!=null&&l.trim()&&(b.websiteUrl=n.websiteUrl.trim()));const v=t==="signup"?"/auth/signup":"/auth/signin",w=yield X.post(v,b);if(w.data.success!==!1)p({token:w.data.token||null,user:w.data.user||null,notice:w.data.message||(t==="signup"?"Account created! Please check your email to verify.":"Welcome back!")});else throw new Error(w.data.message||"Authentication failed")}catch(u){let b="An unexpected error occurred. Please try again.";if(u.message)b=u.message;else if((m=u.response)!=null&&m.data){const v=u.response.data;v.errors&&Array.isArray(v.errors)?b=v.errors.map(w=>`${w.field}: ${w.message}`).join(", "):v.message&&(b=v.message)}h(b)}finally{k(!1),z.current=!1}}}),[n,t,T,p,s,$]),te=f(e=>{if(e.preventDefault(),t==="signup"&&!D){H()&&W(a=>Math.min(a+1,N-1));return}T()&&K()},[t,D,H,N,T,K]),ae=f(()=>{W(e=>Math.max(0,e-1))},[]),ne=c(L,{children:[i(P,{label:"Email Address",type:"email",field:"email",placeholder:"you@example.com",required:!0,autoComplete:"email",form:n,fieldErrors:x,handleInputChange:E,loading:s,darkMode:r}),i(P,{label:"Password",type:"password",field:"password",placeholder:"Enter your password",required:!0,hint:t==="signup"?"Must be 12+ characters with uppercase, lowercase, number, and special character":void 0,autoComplete:t==="signin"?"current-password":"new-password",form:n,fieldErrors:x,handleInputChange:E,loading:s,darkMode:r})]}),ie=c(L,{children:[i(P,{label:"Business Name",field:"businessName",placeholder:"Enter your business name",required:!0,autoComplete:"organization",form:n,fieldErrors:x,handleInputChange:E,loading:s,darkMode:r}),i(P,{label:"Business Phone",field:"businessPhone",placeholder:"+971 50 123 4567",hint:"International format preferred",autoComplete:"tel",form:n,fieldErrors:x,handleInputChange:E,loading:s,darkMode:r}),i(P,{label:"Business Email",type:"email",field:"businessEmail",placeholder:"support@yourbusiness.com",hint:"Different from your login email",autoComplete:"email",form:n,fieldErrors:x,handleInputChange:E,loading:s,darkMode:r}),i(P,{label:"Website URL",type:"url",field:"websiteUrl",placeholder:"https://yourbusiness.com",autoComplete:"url",form:n,fieldErrors:x,handleInputChange:E,loading:s,darkMode:r})]}),oe=t!=="signup"||g===0,le=t==="signup"&&g>=1,ce=s?t==="signin"?"Signing in...":"Creating account...":t==="signup"?D?"Create Account":"Continue":"Sign In",de=f(e=>{q.current&&!q.current.contains(e.target)&&d()},[d]);return M(()=>{const e=a=>{a.key==="Escape"&&d()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d]),i("div",{className:"modal-overlay",onClick:de,style:{position:"fixed",inset:0,background:r?"linear-gradient(135deg, oklch(0.12 0.03 264 / 0.78), oklch(0.08 0.02 270 / 0.65))":"linear-gradient(135deg, oklch(0.92 0.03 264 / 0.75), oklch(0.85 0.03 270 / 0.62))",backdropFilter:"blur(40px) saturate(180%)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"var(--space-sm)",overflowY:"auto"},children:c("div",{ref:q,className:"modal",style:{width:"100%",maxWidth:"520px",maxHeight:"90vh",overflowY:"auto",background:r?"linear-gradient(135deg, oklch(0.18 0.03 264 / 0.92), oklch(0.12 0.02 270 / 0.78))":"linear-gradient(135deg, oklch(0.94 0.02 264 / 0.96), oklch(0.86 0.02 270 / 0.85))",borderRadius:"var(--rounded-2xl)",padding:"var(--space-lg)",border:r?"1px solid oklch(0.35 0.08 264 / 0.35)":"1px solid oklch(0.62 0.05 264 / 0.35)",boxShadow:r?"inset 0 1px 0 oklch(0.45 0.12 264 / 0.2), 0 55px 120px oklch(0.08 0.02 264 / 0.55)":"inset 0 1px 0 oklch(0.84 0.04 264 / 0.3), 0 55px 120px oklch(0.82 0.02 250 / 0.35)",position:"relative",transform:"scale(1)",transition:"all 0.3s ease",backdropFilter:"blur(32px) saturate(180%)",WebkitBackdropFilter:"blur(32px) saturate(180%)"},children:[c("div",{className:"modal-header",style:{marginBottom:"var(--space-md)"},children:[c("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"var(--space-sm)"},children:[i("h2",{style:{fontSize:"1.5rem",fontWeight:"700",color:r?"#f8fafc":"#0f172a",margin:0},children:t==="signin"?"Welcome Back":"Create Your Account"}),i(fe,{})]}),i("button",{className:"close-btn",onClick:d,type:"button",disabled:s,style:{background:"none",border:"none",fontSize:"1.5rem",color:r?"#94a3b8":"#475569",cursor:s?"not-allowed":"pointer",padding:"var(--space-xs)",borderRadius:"var(--rounded-lg)",transition:"all 0.2s ease",opacity:s?.5:1},onMouseEnter:e=>{s||(e.target.style.color=r?"#f8fafc":"#0f172a",e.target.style.background=r?"rgba(148,163,184,0.12)":"rgba(99,102,241,0.12)")},onMouseLeave:e=>{e.target.style.color=r?"#94a3b8":"#475569",e.target.style.background="none"},children:"×"})]}),I&&c("div",{style:{background:r?"linear-gradient(135deg, oklch(0.42 0.22 25 / 0.25), oklch(0.32 0.18 25 / 0.2))":"linear-gradient(135deg, oklch(0.9 0.12 25 / 0.85), oklch(0.82 0.1 25 / 0.72))",border:r?"1px solid oklch(0.6 0.18 25 / 0.45)":"1px solid oklch(0.65 0.16 25 / 0.5)",color:r?"#fecaca":"#b91c1c",padding:"var(--space-sm)",borderRadius:"var(--rounded-lg)",marginBottom:"var(--space-sm)",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"var(--space-xs)"},children:[i("span",{children:"⚠ "}),I]}),c("form",{onSubmit:te,noValidate:!0,style:{display:"grid",gap:"var(--space-md)"},children:[c("div",{style:{display:"grid",gap:"var(--space-xs)"},children:[c("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"var(--space-xs)"},children:[c("span",{style:{fontWeight:600,color:r?"#f8fafc":"#0f172a"},children:["Step ",Math.min(g+1,N)," of ",N]}),i("div",{style:{display:"flex",gap:"var(--space-xs)",flexWrap:"wrap"},children:se.map((e,a)=>{const l=a===g;return c("span",{style:{padding:"calc(var(--space-2xs) * 1.4) var(--space-xs)",borderRadius:"999px",fontSize:"0.8rem",fontWeight:600,background:l?r?"rgba(99,102,241,0.25)":"rgba(79,70,229,0.15)":r?"rgba(148,163,184,0.12)":"rgba(148,163,184,0.18)",color:l?r?"#c7d2fe":"#4338ca":r?"#94a3b8":"#475569",transition:"all 0.2s ease"},children:[a+1,". ",e]},e)})})]}),i("div",{style:{width:"100%",height:"6px",borderRadius:"999px",background:r?"rgba(148,163,184,0.18)":"rgba(148,163,184,0.25)",overflow:"hidden"},children:i("div",{style:{width:`${re}%`,height:"100%",background:"linear-gradient(90deg, #6366f1, #22d3ee)",borderRadius:"inherit",transition:"width 0.35s ease"}})})]}),t==="signup"&&g>0&&c("div",{style:{padding:"var(--space-sm) calc(var(--space-sm) * 1.1)",borderRadius:"1rem",background:r?"rgba(99,102,241,0.12)":"rgba(79,70,229,0.08)",color:r?"#c7d2fe":"#3730a3",display:"grid",gap:"calc(var(--space-2xs) * 1.5)",fontSize:"0.9rem"},children:[i("strong",{style:{fontSize:"0.95rem"},children:"Account ready"}),c("span",{children:["We'll use ",n.email||"your email"," for secure sign in. Need to change it? Just go back one step."]})]}),oe&&i("div",{style:{display:"grid",gap:"var(--space-sm)"},children:ne}),le&&i("div",{style:{display:"grid",gap:"var(--space-sm)"},children:ie}),c("div",{style:{display:"flex",justifyContent:t==="signup"&&g>0?"space-between":"flex-end",alignItems:"center",gap:"var(--space-sm)",marginTop:"var(--space-xs)"},children:[t==="signup"&&g>0&&i("button",{type:"button",onClick:ae,className:"btn",style:{padding:"calc(var(--space-sm) * 0.85) var(--space-md)",borderRadius:"0.85rem",background:r?"rgba(148,163,184,0.15)":"rgba(148,163,184,0.2)",color:r?"#e2e8f0":"#1f2937",border:"none",fontWeight:600,cursor:"pointer"},children:"← Back"}),c("button",{className:"btn btn-primary",type:"submit",disabled:s,style:{width:t==="signup"&&g>0?"auto":"100%",minWidth:"160px",padding:"calc(var(--space-sm) * 0.9) var(--space-md)",fontSize:"1rem",fontWeight:"600",opacity:s?.7:1,cursor:s?"not-allowed":"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"var(--space-xs)",boxShadow:r?"0 20px 35px rgba(99, 102, 241, 0.35)":"0 20px 35px rgba(99, 102, 241, 0.25)"},children:[s&&i("div",{style:{width:"16px",height:"16px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),i("span",{children:ce})]})]})]}),i("div",{style:{marginTop:"var(--space-md)",fontSize:"0.875rem",textAlign:"center",color:r?"#94a3b8":"#475569"},children:t==="signin"?c(L,{children:["New to Artifically?"," ",i("button",{className:"linklike",onClick:J,type:"button",disabled:s,style:{opacity:s?.5:1,cursor:s?"not-allowed":"pointer"},children:"Create an account"})]}):c(L,{children:["Already have an account?"," ",i("button",{className:"linklike",onClick:J,type:"button",disabled:s,style:{opacity:s?.5:1,cursor:s?"not-allowed":"pointer"},children:"Sign in"})]})})]})})};export{ze as default};
