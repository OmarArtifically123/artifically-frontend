var ne=Object.defineProperty,ie=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var G=(d,u,l)=>u in d?ne(d,u,{enumerable:!0,configurable:!0,writable:!0,value:l}):d[u]=l,S=(d,u)=>{for(var l in u||(u={}))le.call(u,l)&&G(d,l,u[l]);if(V)for(var l of V(u))ce.call(u,l)&&G(d,l,u[l]);return d},U=(d,u)=>ie(d,oe(u));var $=(d,u,l)=>new Promise((a,t)=>{var v=r=>{try{h(l.next(r))}catch(x){t(x)}},i=r=>{try{h(l.throw(r))}catch(x){t(x)}},h=r=>r.done?a(r.value):Promise.resolve(r.value).then(v,i);h((l=l.apply(d,u)).next())});import{r as o,j as s}from"./react-vendor-bEOajVqR.js";import{u as de,b as H,T as ue}from"./index-CrGJeRyx.js";import{an as pe}from"./vendor-CtYYAZJ3.js";import"./three-vendor-7241h_j-.js";import"./framer-vendor-DE1cJCbf.js";import"./gsap-vendor-DSkmy12n.js";const E=({label:d,type:u="text",field:l,placeholder:a,required:t=!1,hint:v,autoComplete:i,form:h,fieldErrors:r,handleInputChange:x,loading:F,darkMode:f})=>s.jsxs("div",{className:"form-group",style:{display:"grid",gap:"calc(var(--space-2xs) * 1.5)"},children:[s.jsxs("label",{className:"form-label",style:{fontWeight:600,color:f?"#e2e8f0":"#1f2937"},children:[d," ",t&&s.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),s.jsx("input",{className:`form-input ${r[l]?"error":""}`,type:u,value:h[l],onChange:y=>x(l,y.target.value),placeholder:a,required:t,disabled:F,autoComplete:i,style:{borderColor:r[l]?"#ef4444":f?"rgba(148,163,184,0.4)":"rgba(148,163,184,0.55)",background:f?"rgba(15,23,42,0.85)":"rgba(255,255,255,0.95)",color:f?"#e2e8f0":"#1f2937",padding:"var(--space-xs) var(--space-sm)",borderRadius:"0.85rem",transition:"all 0.2s ease"}}),r[l]&&s.jsxs("div",{style:{color:"#ef4444",fontSize:"0.75rem",marginTop:"var(--space-2xs)",display:"flex",alignItems:"center",gap:"var(--space-2xs)"},children:[s.jsx("span",{children:"⚠ "}),r[l]]}),v&&!r[l]&&s.jsx("small",{className:"form-hint",style:{color:f?"#94a3b8":"#475569",fontSize:"0.8rem"},children:v})]}),ke=({onClose:d,onAuthenticated:u,initialMode:l="signin"})=>{const{darkMode:a}=de(),[t,v]=o.useState(l),[i,h]=o.useState({email:"",password:"",businessName:"",businessPhone:"",businessEmail:"",websiteUrl:""}),[r,x]=o.useState(!1),[F,f]=o.useState(""),[y,R]=o.useState({}),[B,J]=o.useState(""),[g,P]=o.useState(0),T=o.useRef(null),A=o.useRef(!1),M=o.useMemo(()=>t==="signup"?[["email","password"],["businessName","businessPhone","businessEmail","websiteUrl"]]:[["email","password"]],[t]),K=o.useMemo(()=>t==="signup"?["Account","Business Profile"]:["Secure Sign In"],[t]),j=M.length,L=g>=j-1,Z=Math.round((g+1)/j*100);o.useEffect(()=>{$(void 0,null,function*(){try{const n=yield H.get("/auth/csrf-token");J(n.data.csrfToken)}catch(n){console.warn("Could not get CSRF token:",n)}})},[]),o.useEffect(()=>{P(0),f(""),R({})},[t]);const N=o.useMemo(()=>({email:e=>{var c;const n=((c=e==null?void 0:e.trim)==null?void 0:c.call(e))||"";return n?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?null:"Invalid email format":"Email is required"},password:e=>{if(!e)return"Password is required";if(t==="signup"){if(e.length<12)return"Password must be at least 12 characters";if(!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])/.test(e))return"Password must include uppercase, lowercase, number, and special character"}return null},businessName:e=>{var c;if(t!=="signup")return null;const n=((c=e==null?void 0:e.trim)==null?void 0:c.call(e))||"";return!n||n.length<2?"Business name is required":null},businessPhone:e=>e?/^\+?[\d\s\-()]+$/.test(e)?null:"Invalid phone number format":null,businessEmail:e=>e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?null:"Invalid business email format":null,websiteUrl:e=>e?/^https?:\/\/.+\..+/.test(e)?null:"Website URL must include protocol (https://)":null}),[t]),q=o.useCallback((e,n=i[e])=>{const c=N[e];if(!c)return!0;const m=c(n);return R(p=>U(S({},p),{[e]:m})),!m},[i,N]),I=o.useMemo(()=>pe((e,n)=>{q(e,n)},250),[q]);o.useEffect(()=>()=>I.cancel(),[I]);const C=o.useCallback((e,n)=>{h(c=>U(S({},c),{[e]:n})),f(""),I(e,n)},[I]),W=o.useCallback(e=>{const n=e&&e.length?e:Object.keys(N),c={};return n.forEach(m=>{const p=N[m];p&&(c[m]=p(i[m])||null)}),Object.keys(c).length&&R(m=>S(S({},m),Object.fromEntries(Object.entries(c).map(([p,b])=>[p,b])))),Object.values(c).every(m=>!m)},[i,N]),z=o.useCallback(()=>W(),[W]),O=o.useCallback(()=>W(M[g]||[]),[M,g,W]),D=o.useCallback(()=>{v(e=>e==="signin"?"signup":"signin"),f(""),R({}),P(0),h({email:i.email,password:"",businessName:"",businessPhone:"",businessEmail:"",websiteUrl:""})},[i.email]),Y=o.useCallback(()=>$(void 0,null,function*(){var e,n,c,m;if(!(A.current||r)){if(A.current=!0,f(""),!z()){A.current=!1;return}x(!0);try{const p=i.email.trim().toLowerCase(),b=S({identifier:p,email:p,password:i.password},B&&{_csrf:B});t==="signup"&&(b.businessName=i.businessName.trim(),(e=i.businessPhone)!=null&&e.trim()&&(b.businessPhone=i.businessPhone.trim()),(n=i.businessEmail)!=null&&n.trim()&&(b.businessEmail=i.businessEmail.trim().toLowerCase()),(c=i.websiteUrl)!=null&&c.trim()&&(b.websiteUrl=i.websiteUrl.trim()));const w=t==="signup"?"/auth/signup":"/auth/signin",k=yield H.post(w,b);if(k.data.success!==!1)u({token:k.data.token||null,user:k.data.user||null,notice:k.data.message||(t==="signup"?"Account created! Please check your email to verify.":"Welcome back!")});else throw new Error(k.data.message||"Authentication failed")}catch(p){let b="An unexpected error occurred. Please try again.";if(p.message)b=p.message;else if((m=p.response)!=null&&m.data){const w=p.response.data;w.errors&&Array.isArray(w.errors)?b=w.errors.map(k=>`${k.field}: ${k.message}`).join(", "):w.message&&(b=w.message)}f(b)}finally{x(!1),A.current=!1}}}),[i,t,z,u,r,B]),_=o.useCallback(e=>{if(e.preventDefault(),t==="signup"&&!L){O()&&P(n=>Math.min(n+1,j-1));return}z()&&Y()},[t,L,O,j,z,Y]),Q=o.useCallback(()=>{P(e=>Math.max(0,e-1))},[]),X=s.jsxs(s.Fragment,{children:[s.jsx(E,{label:"Email Address",type:"email",field:"email",placeholder:"you@example.com",required:!0,autoComplete:"email",form:i,fieldErrors:y,handleInputChange:C,loading:r,darkMode:a}),s.jsx(E,{label:"Password",type:"password",field:"password",placeholder:"Enter your password",required:!0,hint:t==="signup"?"Must be 12+ characters with uppercase, lowercase, number, and special character":void 0,autoComplete:t==="signin"?"current-password":"new-password",form:i,fieldErrors:y,handleInputChange:C,loading:r,darkMode:a})]}),ee=s.jsxs(s.Fragment,{children:[s.jsx(E,{label:"Business Name",field:"businessName",placeholder:"Enter your business name",required:!0,autoComplete:"organization",form:i,fieldErrors:y,handleInputChange:C,loading:r,darkMode:a}),s.jsx(E,{label:"Business Phone",field:"businessPhone",placeholder:"+971 50 123 4567",hint:"International format preferred",autoComplete:"tel",form:i,fieldErrors:y,handleInputChange:C,loading:r,darkMode:a}),s.jsx(E,{label:"Business Email",type:"email",field:"businessEmail",placeholder:"support@yourbusiness.com",hint:"Different from your login email",autoComplete:"email",form:i,fieldErrors:y,handleInputChange:C,loading:r,darkMode:a}),s.jsx(E,{label:"Website URL",type:"url",field:"websiteUrl",placeholder:"https://yourbusiness.com",autoComplete:"url",form:i,fieldErrors:y,handleInputChange:C,loading:r,darkMode:a})]}),se=t!=="signup"||g===0,re=t==="signup"&&g>=1,ae=r?t==="signin"?"Signing in...":"Creating account...":t==="signup"?L?"Create Account":"Continue":"Sign In",te=o.useCallback(e=>{T.current&&!T.current.contains(e.target)&&d()},[d]);return o.useEffect(()=>{const e=n=>{n.key==="Escape"&&d()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d]),s.jsx("div",{className:"modal-overlay",onClick:te,style:{position:"fixed",inset:0,background:a?"linear-gradient(135deg, oklch(0.12 0.03 264 / 0.78), oklch(0.08 0.02 270 / 0.65))":"linear-gradient(135deg, oklch(0.92 0.03 264 / 0.75), oklch(0.85 0.03 270 / 0.62))",backdropFilter:"blur(40px) saturate(180%)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"var(--space-sm)",overflowY:"auto"},children:s.jsxs("div",{ref:T,className:"modal",style:{width:"100%",maxWidth:"520px",maxHeight:"90vh",overflowY:"auto",background:a?"linear-gradient(135deg, oklch(0.18 0.03 264 / 0.92), oklch(0.12 0.02 270 / 0.78))":"linear-gradient(135deg, oklch(0.94 0.02 264 / 0.96), oklch(0.86 0.02 270 / 0.85))",borderRadius:"var(--rounded-2xl)",padding:"var(--space-lg)",border:a?"1px solid oklch(0.35 0.08 264 / 0.35)":"1px solid oklch(0.62 0.05 264 / 0.35)",boxShadow:a?"inset 0 1px 0 oklch(0.45 0.12 264 / 0.2), 0 55px 120px oklch(0.08 0.02 264 / 0.55)":"inset 0 1px 0 oklch(0.84 0.04 264 / 0.3), 0 55px 120px oklch(0.82 0.02 250 / 0.35)",position:"relative",transform:"scale(1)",transition:"all 0.3s ease",backdropFilter:"blur(32px) saturate(180%)",WebkitBackdropFilter:"blur(32px) saturate(180%)"},children:[s.jsxs("div",{className:"modal-header",style:{marginBottom:"var(--space-md)"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"var(--space-sm)"},children:[s.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"700",color:a?"#f8fafc":"#0f172a",margin:0},children:t==="signin"?"Welcome Back":"Create Your Account"}),s.jsx(ue,{})]}),s.jsx("button",{className:"close-btn",onClick:d,type:"button",disabled:r,style:{background:"none",border:"none",fontSize:"1.5rem",color:a?"#94a3b8":"#475569",cursor:r?"not-allowed":"pointer",padding:"var(--space-xs)",borderRadius:"var(--rounded-lg)",transition:"all 0.2s ease",opacity:r?.5:1},onMouseEnter:e=>{r||(e.target.style.color=a?"#f8fafc":"#0f172a",e.target.style.background=a?"rgba(148,163,184,0.12)":"rgba(99,102,241,0.12)")},onMouseLeave:e=>{e.target.style.color=a?"#94a3b8":"#475569",e.target.style.background="none"},children:"×"})]}),F&&s.jsxs("div",{style:{background:a?"linear-gradient(135deg, oklch(0.42 0.22 25 / 0.25), oklch(0.32 0.18 25 / 0.2))":"linear-gradient(135deg, oklch(0.9 0.12 25 / 0.85), oklch(0.82 0.1 25 / 0.72))",border:a?"1px solid oklch(0.6 0.18 25 / 0.45)":"1px solid oklch(0.65 0.16 25 / 0.5)",color:a?"#fecaca":"#b91c1c",padding:"var(--space-sm)",borderRadius:"var(--rounded-lg)",marginBottom:"var(--space-sm)",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"var(--space-xs)"},children:[s.jsx("span",{children:"⚠ "}),F]}),s.jsxs("form",{onSubmit:_,noValidate:!0,style:{display:"grid",gap:"var(--space-md)"},children:[s.jsxs("div",{style:{display:"grid",gap:"var(--space-xs)"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"var(--space-xs)"},children:[s.jsxs("span",{style:{fontWeight:600,color:a?"#f8fafc":"#0f172a"},children:["Step ",Math.min(g+1,j)," of ",j]}),s.jsx("div",{style:{display:"flex",gap:"var(--space-xs)",flexWrap:"wrap"},children:K.map((e,n)=>{const c=n===g;return s.jsxs("span",{style:{padding:"calc(var(--space-2xs) * 1.4) var(--space-xs)",borderRadius:"999px",fontSize:"0.8rem",fontWeight:600,background:c?a?"rgba(99,102,241,0.25)":"rgba(79,70,229,0.15)":a?"rgba(148,163,184,0.12)":"rgba(148,163,184,0.18)",color:c?a?"#c7d2fe":"#4338ca":a?"#94a3b8":"#475569",transition:"all 0.2s ease"},children:[n+1,". ",e]},e)})})]}),s.jsx("div",{style:{width:"100%",height:"6px",borderRadius:"999px",background:a?"rgba(148,163,184,0.18)":"rgba(148,163,184,0.25)",overflow:"hidden"},children:s.jsx("div",{style:{width:`${Z}%`,height:"100%",background:"linear-gradient(90deg, #6366f1, #22d3ee)",borderRadius:"inherit",transition:"width 0.35s ease"}})})]}),t==="signup"&&g>0&&s.jsxs("div",{style:{padding:"var(--space-sm) calc(var(--space-sm) * 1.1)",borderRadius:"1rem",background:a?"rgba(99,102,241,0.12)":"rgba(79,70,229,0.08)",color:a?"#c7d2fe":"#3730a3",display:"grid",gap:"calc(var(--space-2xs) * 1.5)",fontSize:"0.9rem"},children:[s.jsx("strong",{style:{fontSize:"0.95rem"},children:"Account ready"}),s.jsxs("span",{children:["We'll use ",i.email||"your email"," for secure sign in. Need to change it? Just go back one step."]})]}),se&&s.jsx("div",{style:{display:"grid",gap:"var(--space-sm)"},children:X}),re&&s.jsx("div",{style:{display:"grid",gap:"var(--space-sm)"},children:ee}),s.jsxs("div",{style:{display:"flex",justifyContent:t==="signup"&&g>0?"space-between":"flex-end",alignItems:"center",gap:"var(--space-sm)",marginTop:"var(--space-xs)"},children:[t==="signup"&&g>0&&s.jsx("button",{type:"button",onClick:Q,className:"btn",style:{padding:"calc(var(--space-sm) * 0.85) var(--space-md)",borderRadius:"0.85rem",background:a?"rgba(148,163,184,0.15)":"rgba(148,163,184,0.2)",color:a?"#e2e8f0":"#1f2937",border:"none",fontWeight:600,cursor:"pointer"},children:"← Back"}),s.jsxs("button",{className:"btn btn-primary",type:"submit",disabled:r,style:{width:t==="signup"&&g>0?"auto":"100%",minWidth:"160px",padding:"calc(var(--space-sm) * 0.9) var(--space-md)",fontSize:"1rem",fontWeight:"600",opacity:r?.7:1,cursor:r?"not-allowed":"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"var(--space-xs)",boxShadow:a?"0 20px 35px rgba(99, 102, 241, 0.35)":"0 20px 35px rgba(99, 102, 241, 0.25)"},children:[r&&s.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),s.jsx("span",{children:ae})]})]})]}),s.jsx("div",{style:{marginTop:"var(--space-md)",fontSize:"0.875rem",textAlign:"center",color:a?"#94a3b8":"#475569"},children:t==="signin"?s.jsxs(s.Fragment,{children:["New to Artifically?"," ",s.jsx("button",{className:"linklike",onClick:D,type:"button",disabled:r,style:{opacity:r?.5:1,cursor:r?"not-allowed":"pointer"},children:"Create an account"})]}):s.jsxs(s.Fragment,{children:["Already have an account?"," ",s.jsx("button",{className:"linklike",onClick:D,type:"button",disabled:r,style:{opacity:r?.5:1,cursor:r?"not-allowed":"pointer"},children:"Sign in"})]})})]})})};export{ke as default};
