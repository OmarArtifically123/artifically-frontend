var L=Object.defineProperty,j=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var t=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var d=(c,s,g)=>s in c?L(c,s,{enumerable:!0,configurable:!0,writable:!0,value:g}):c[s]=g,A=(c,s)=>{for(var g in s||(s={}))z.call(s,g)&&d(c,g,s[g]);if(t)for(var g of t(s))E.call(s,g)&&d(c,g,s[g]);return c},h=(c,s)=>j(c,I(s));(function(){"use strict";self.onmessage=c=>{const s=c==null?void 0:c.data;if(!s||typeof s!="object"){self.postMessage({type:"error",message:"Invalid payload"});return}const{automations:g=[],signals:b=[],focus:v}=s,i=[],o=new Map,f=[];g.forEach(e=>{if(!e||typeof e!="object")return;const r=Number(e==null?void 0:e.roi);Number.isFinite(r)&&i.push(r);const l=(e==null?void 0:e.category)||(e==null?void 0:e.vertical)||"General",n=o.get(l)||{count:0,roi:0};n.count+=1,Number.isFinite(r)&&(n.roi+=r),o.set(l,n);const N=Array.isArray(e==null?void 0:e.tags)?e.tags:[],y=b.filter(S=>{const p=String(S||"").toLowerCase();return p&&(String(l).toLowerCase().includes(p)||N.some(F=>String(F).toLowerCase().includes(p)))});y.length>=2&&f.push({id:e.id,name:e.name,overlap:y,roi:Number.isFinite(r)?r:0})});const w=i.length>0?i.reduce((e,r)=>e+r,0)/i.length:null,C=Array.from(o.entries()).map(([e,{count:r,roi:l}])=>({category:e,count:r,roiAverage:r>0?l/r:0})).sort((e,r)=>r.roiAverage===e.roiAverage?r.count-e.count:r.roiAverage-e.roiAverage)[0]||null,M=f.map(e=>h(A({},e),{score:e.roi+e.overlap.length*1.75+(v?2.5:0)})).sort((e,r)=>r.score-e.score).slice(0,3);self.postMessage({type:"metrics",averageROI:w,topCategory:C,combo:M})}})();
